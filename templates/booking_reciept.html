{% extends 'base.html' %}

{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/print_button.scss' %}">
<style>
	.btn-success{
		background-color: #00B2BD;
		color: rgb(255, 255, 255);
	}
	.btn-success:hover{
		background-color: rgb(255, 255, 255);
		color: #00B2BD;
	}
    
	
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script>
    $('#print').click(function() {
        window.print();
        return false;
       
    });
</script>
<div class="container" style="margin-top: 50px;">
    <center><svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px"
        width="64" height="64"
        viewBox="0 0 172 172"
        style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,172v-172h172v172z" fill="none"></path><g><g><g><path d="M86,24.22041c34.11993,0 61.77959,27.65967 61.77959,61.77959c0,34.11993 -27.65967,61.77959 -61.77959,61.77959c-34.11993,0 -61.77959,-27.65967 -61.77959,-61.77959c-0.04679,-16.39927 6.44709,-32.14035 18.04317,-43.73642c11.59608,-11.59608 27.33716,-18.08996 43.73642,-18.04317zM76.34694,112.85306l43.87755,-43.87755l-10.00408,-9.82857l-33.87347,33.87347l-14.56735,-14.39184l-10.00408,9.82857z" fill="#00b2bd"></path><path d="M120.22449,68.97551l-43.87755,43.87755l-24.57143,-24.39592l10.00408,-9.82857l14.56735,14.39184l33.87347,-33.87347z" fill="#ffffff"></path></g><g fill="#000000"><g><path d="M86,151.2898c-36.05856,0 -65.2898,-29.23124 -65.2898,-65.2898c0,-36.05856 29.23124,-65.2898 65.2898,-65.2898c36.05856,0 65.2898,29.23124 65.2898,65.2898c-0.09644,36.01854 -29.27126,65.19336 -65.2898,65.2898zM86,27.73061c-32.18129,0 -58.26939,26.08809 -58.26939,58.26939c0,32.18129 26.08809,58.26939 58.26939,58.26939c32.18129,0 58.26939,-26.08809 58.26939,-58.26939c0,-32.18129 -26.08809,-58.26939 -58.26939,-58.26939z"></path></g><g><path d="M76.34694,116.36327c-0.98659,0.0348 -1.94223,-0.34746 -2.63265,-1.05306l-24.39592,-24.39592c-0.68836,-0.63158 -1.08022,-1.52294 -1.08022,-2.45714c0,-0.9342 0.39187,-1.82556 1.08022,-2.45714l10.00408,-10.00408c1.3991,-1.25139 3.51519,-1.25139 4.91429,0l12.1102,12.1102l31.41633,-31.41633c0.63158,-0.68836 1.52294,-1.08022 2.45714,-1.08022c0.9342,0 1.82556,0.39187 2.45714,1.08022l10.00408,9.82857c0.68836,0.63158 1.08022,1.52294 1.08022,2.45714c0,0.9342 -0.39187,1.82556 -1.08022,2.45714l-43.87755,43.87755c-0.64809,0.66137 -1.53126,1.03987 -2.45714,1.05306zM56.86531,88.45714l19.48163,19.48163l38.78776,-38.96327l-4.91429,-4.91429l-31.41633,31.41633c-1.42425,1.35951 -3.66555,1.35951 -5.0898,0l-11.93469,-11.93469z"></path></g></g></g></g></g></svg></center>
    <h2 class="text-center">Payment Successful</h2>
	<br>
	<div class="text-center">
		<a href="{% url 'ordered_details'%}" class="btn btn-success">Go to Booking</a>
        <button  onclick="printDiv('printableArea')"  class="btn btn-success">Print Reciept</button>
	</div>
    
</div>
<div class="container html-content" id="printableArea">
    <div class="card mt-5 mb-5 shadow p-3 rounded">
        <div class="card-body">
    <div class="row invoice row-printable">
        <div class="col-md-12">
            <!-- col-lg-12 start here -->
            <div class="panel panel-default plain" id="dash_0">
                <!-- Start .panel -->
                <div class="panel-body p30">
                    <div class="row">
                        <!-- Start .row -->
                        <div class="col-lg-6">
                            <!-- col-lg-6 start here -->
                           <h2 style="font-family: 'Mochiy Pop One', sans-serif; font-size:x-large" >SHAZAM</h2>
                        </div>
                        <!-- col-lg-6 end here -->
                        <div class="col-lg-6">
                            <!-- col-lg-6 start here -->
                            <div class="invoice-from">
                                <ul class="list-unstyled text-right">
                                    <li><strong>Invoiced To</strong></li>
                                    <li>{{order.full_name}}</li>
                                    <li>{{order.address_line_1}}</li>
                                    <li>{{order.address_line_2}}</li>
                                    <li>{{order.city}} {{order.zip_code}}</li>
                                    <li>{{order.state}} {{order.country}}</li>
                                    <li>{{order.mobile}}</li>
                                </ul>
                            </div>
                        </div>
                        <!-- col-lg-6 end here -->
                        <div class="col-lg-12">
                            <!-- col-lg-12 start here -->
                            <div class="invoice-details mt25">
                                <div class="well">
                                    <ul class="list-unstyled mb0">
                                        <li><strong>Booking ID</strong> {{order.order_number}}</li>
                                        <li><strong>Transaction</strong> {{payment_id}}</li>
                                        <li><strong>Booking Date:</strong> {{order.created_at}}</li>
                                        <li><strong>Payment Gateway:</strong> {{order.payment_option}}</li>
                                        <li><strong>Status:</strong> PAID</li>
                                    </ul>
                                </div>
                            </div>
                           
                            <div class="invoice-items">
                                <div class="table-responsive" style="overflow: hidden; outline: none;" tabindex="0">
                                    <table class="table table-bordered ">
                                        <thead>
                                            <tr>
                                                <th class="per40 text-center">Vehicle</th>
                                                <th class="per40 text-center">Category</th>
                                                <th class="per40 text-center">Color</th>
                                                <th class="per40 text-center">Seller</th>
                                                <th class="per5 text-center">Qty</th>
                                                <th class="per10 text-center">Pending Amount</th>
                                                <th class="per25 text-center">Booking Amount</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for order_details in ordered_vehicle_details %}
                                            <tr>
                                                <td>
                                                    <div class="d-flex justify-content-between">
                                                    <div class="">
                                                        {{order_details.vehicle.vehicle_name}} 

                                                    </div>
                                                    

                                                </div>
                                            </td>
                                                <td class="text-center">{{order_details.vehicle.category}}</td>
                                                <td class="text-center"><div class="" style="border-radius: 3px;width: 40px;height: 20px;background-color: {{order_details.variant.color}};">

                                                </div></td>
                                                <td class="text-center">{{order_details.vehicle.vendor_id}}</td>
                                                <td class="text-center">{{order_details.quantity}}</td>
                                                <td class="text-center">₹{{order_details.price |floatformat:0}}</td>
                                                <td class="text-center">₹{{order_details.paid}}</td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th colspan="6" class="text-right">Discount Price:</th>
                                                <th style="color: green;" class="text-center">-₹{{order.discount_price|floatformat:0}} INR</th>
                                            </tr>
                                            <tr>
                                                <th colspan="6" class="text-right">Sub Total:</th>
                                                <th class="text-center">₹{{order.order_total|floatformat:0}} INR</th>
                                            </tr>
                                            
                                            <tr>
                                                <th colspan="6" class="text-right">Tax:</th>
                                                <th class="text-center">₹{{order.tax |floatformat:0}} INR</th>
                                            </tr>
                                            
                                            
                                            <tr>
                                                <th colspan="6" class="text-right">Grand Total:</th>
                                                <th class="text-center">₹{{grand_total_paid}} INR</th>
                                            </tr>
                                        </tfoot>
                                    </table>
                                </div>
                            </div>
                            <div class="invoice-footer mt25">
                                <p class="text-center">Thank you for shopping with us!</p>
                            </div>
                        </div>
                        <!-- col-lg-12 end here -->
                    </div>
                    <!-- End .row -->
                </div>
            </div>
            <!-- End .panel -->
        </div>
        <!-- col-lg-12 end here -->
    </div>
    </div>
</div>
</div>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
<script type="text/javascript" src="https://html2canvas.hertzen.com/dist/html2canvas.js"></script>
<script>
    window.addEventListener('load', CreatePDFfromHTML());
    
    function printDiv(divName) {
        var printContents = document.getElementById(divName).innerHTML;
        var originalContents = document.body.innerHTML;
   
        document.body.innerHTML = printContents;
   
        window.print();
   
        document.body.innerHTML = originalContents;
   }
   function CreatePDFfromHTML() {
    var HTML_Width = $(".html-content").width();
    var HTML_Height = $(".html-content").height();
    var top_left_margin = 15;
    var PDF_Width = HTML_Width + (top_left_margin * 2);
    var PDF_Height = (PDF_Width * 1.5) + (top_left_margin * 2);
    var canvas_image_width = HTML_Width;
    var canvas_image_height = HTML_Height;

    var totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;

    html2canvas($(".html-content")[0]).then(function (canvas) {
        var imgData = canvas.toDataURL("image/jpeg", 1.0);
        var pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
        pdf.addImage(imgData, 'JPG', top_left_margin, top_left_margin, canvas_image_width, canvas_image_height);
        for (var i = 1; i <= totalPDFPages; i++) {
            pdf.addPage(PDF_Width, PDF_Height);
            pdf.addImage(imgData, 'JPG', top_left_margin, -(PDF_Height*i)+(top_left_margin*4),canvas_image_width,canvas_image_height);
        }
        pdf.save("Booking_Reciept.pdf");
        
    });
}
</script>

{% endblock %}